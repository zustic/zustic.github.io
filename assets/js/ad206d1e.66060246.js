"use strict";(globalThis.webpackChunkzustic_doc=globalThis.webpackChunkzustic_doc||[]).push([[9254],{2031(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>o});var a=t(3011),i=t(4848),r=t(8453);const s={slug:"understanding-middleware-in-state-management",title:"Understanding Middleware: The Power Behind State Management",authors:["zustic"],tags:["middleware","react","state-management","zustic"],description:"Deep dive into middleware patterns. Learn how middleware extends state management with logging, persistence, validation, and more.",image:"/img/logo.png"},l="Understanding Middleware: The Power Behind State Management",d={authorsImageUrls:[void 0]},o=[{value:"What is Middleware?",id:"what-is-middleware",level:2},{value:"How Middleware Works",id:"how-middleware-works",level:2},{value:"Middleware Signature",id:"middleware-signature",level:2},{value:"Basic Logger Middleware",id:"basic-logger-middleware",level:2},{value:"Using Multiple Middleware",id:"using-multiple-middleware",level:2},{value:"Common Middleware Patterns",id:"common-middleware-patterns",level:2},{value:"1. Persistence Middleware",id:"1-persistence-middleware",level:3},{value:"2. Validation Middleware",id:"2-validation-middleware",level:3},{value:"3. Time Travel / History Middleware",id:"3-time-travel--history-middleware",level:3},{value:"4. Analytics Middleware",id:"4-analytics-middleware",level:3},{value:"5. Debounce Middleware",id:"5-debounce-middleware",level:3},{value:"Real-World Example",id:"real-world-example",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Keep Middleware Pure",id:"1-keep-middleware-pure",level:3},{value:"2. Call <code>next</code> Only Once",id:"2-call-next-only-once",level:3},{value:"3. Order Matters",id:"3-order-matters",level:3},{value:"4. Handle Errors Gracefully",id:"4-handle-errors-gracefully",level:3},{value:"Performance Tips",id:"performance-tips",level:2},{value:"1. Keep Middleware Lightweight",id:"1-keep-middleware-lightweight",level:3},{value:"2. Consider Conditional Middleware",id:"2-consider-conditional-middleware",level:3},{value:"Testing Middleware",id:"testing-middleware",level:2},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Middleware is one of the most powerful but often misunderstood concepts in state management. In this post, we'll demystify middleware and show you how to use it effectively with Zustic."}),"\n",(0,i.jsx)(n.h2,{id:"what-is-middleware",children:"What is Middleware?"}),"\n",(0,i.jsx)(n.p,{children:"Middleware is a function that intercepts state changes and can perform side effects, validations, logging, or transformations before the state is actually updated."}),"\n",(0,i.jsx)(n.p,{children:"Think of it like a security checkpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"User Action \u2192 Middleware 1 \u2192 Middleware 2 \u2192 Middleware 3 \u2192 State Updated\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each middleware can inspect, validate, or modify the action before it reaches the next middleware or the state."}),"\n",(0,i.jsx)(n.h2,{id:"how-middleware-works",children:"How Middleware Works"}),"\n",(0,i.jsx)(n.p,{children:"Middleware in Zustic follows a simple but powerful pattern. Think of it like a pipeline:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"User Action \u2192 Middleware 1 \u2192 Middleware 2 \u2192 Middleware 3 \u2192 setState\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each middleware can:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"See the previous state"}),"\n",(0,i.jsx)(n.li,{children:"See the update being made"}),"\n",(0,i.jsx)(n.li,{children:"Allow the update to proceed"}),"\n",(0,i.jsx)(n.li,{children:"Modify the update before it reaches the next middleware"}),"\n",(0,i.jsx)(n.li,{children:"React after the update is complete"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"middleware-signature",children:"Middleware Signature"}),"\n",(0,i.jsx)(n.p,{children:"Every middleware in Zustic follows this pattern:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"type Middleware<T> = (\n  set: (partial: SetStateParams<T>) => void,\n  get: () => T\n) => (\n  next: (partial: SetStateParams<T>) => void\n) => (partial: SetStateParams<T>) => void\n"})}),"\n",(0,i.jsx)(n.p,{children:"Breaking it down:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Outer function"})," receives ",(0,i.jsx)(n.code,{children:"set"})," (update function) and ",(0,i.jsx)(n.code,{children:"get"})," (state getter)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Middle function"})," receives ",(0,i.jsx)(n.code,{children:"next"})," (the next middleware or setState)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inner function"})," receives the actual update to be applied"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"basic-logger-middleware",children:"Basic Logger Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Here's the simplest middleware - a logger:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const loggerMiddleware = (set, get) => (next) => async (partial) => {\n  // Log BEFORE the update\n  const previousState = get();\n  console.log('Previous state:', previousState);\n  console.log('Update:', partial);\n\n  // Call the next middleware/setState\n  await next(partial);\n\n  // Log AFTER the update\n  console.log('New state:', get());\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"Using it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const useStore = create(\n  (set, get) => ({\n    count: 0,\n    increment: () => set((state) => ({ count: state.count + 1 })),\n  }),\n  loggerMiddleware // Add middleware here\n);\n\n// Now every update is logged!\nuseStore.setState((state) => ({ count: state.count + 1 }));\n// Logs: Previous: {count: 0}\n// Logs: Update: {count: 1}\n// Logs: New: {count: 1}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"using-multiple-middleware",children:"Using Multiple Middleware"}),"\n",(0,i.jsx)(n.p,{children:"You can chain multiple middleware together:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const useStore = create(\n  (set, get) => ({\n    count: 0,\n    increment: () => set((state) => ({ count: state.count + 1 })),\n  }),\n  [loggerMiddleware, persistenceMiddleware, validationMiddleware]\n);\n\n// Execution order:\n// loggerMiddleware \u2192 persistenceMiddleware \u2192 validationMiddleware \u2192 setState\n"})}),"\n",(0,i.jsx)(n.p,{children:"The order matters! Middleware execute from left to right."}),"\n",(0,i.jsx)(n.h2,{id:"common-middleware-patterns",children:"Common Middleware Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"1-persistence-middleware",children:"1. Persistence Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Auto-save state to localStorage:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const persistenceMiddleware = (key: string) => (set, get) => (next) => async (partial) => {\n  // Apply the update\n  await next(partial);\n\n  // Then save to localStorage\n  try {\n    const state = get();\n    localStorage.setItem(key, JSON.stringify(state));\n    console.log('\ud83d\udcbe Saved to localStorage');\n  } catch (error) {\n    console.error('Failed to persist:', error);\n  }\n};\n\n// Usage:\nconst useStore = create(\n  (set, get) => {\n    // Load initial state from localStorage\n    const saved = localStorage.getItem('mystore');\n    return {\n      ...JSON.parse(saved || '{}'),\n      count: 0,\n      increment: () => set((state) => ({ count: state.count + 1 })),\n    };\n  },\n  persistenceMiddleware('mystore')\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-validation-middleware",children:"2. Validation Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Validate updates before they're applied:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const validationMiddleware = (set, get) => (next) => async (partial) => {\n  const state = get();\n  const updates = typeof partial === 'function' ? partial(state) : partial;\n\n  // Validate the update\n  if ('age' in updates && typeof updates.age === 'number' && updates.age < 0) {\n    console.error(' Age cannot be negative!');\n    return; // Reject the update\n  }\n\n  if ('email' in updates && !updates.email.includes('@')) {\n    console.error(' Invalid email format!');\n    return;\n  }\n\n  // Update is valid, proceed\n  await next(partial);\n  console.log(' Validation passed');\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-time-travel--history-middleware",children:"3. Time Travel / History Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Store history for debugging and time-travel:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const historyMiddleware = (set, get) => {\n  let history: any[] = [get()];\n  let historyIndex = 0;\n\n  // Expose time-travel functions\n  if (typeof window !== 'undefined') {\n    (window as any).__devtools__ = {\n      undo: () => {\n        if (historyIndex > 0) {\n          historyIndex--;\n          set(history[historyIndex]);\n        }\n      },\n      redo: () => {\n        if (historyIndex < history.length - 1) {\n          historyIndex++;\n          set(history[historyIndex]);\n        }\n      },\n      getHistory: () => history,\n    };\n  }\n\n  return (next) => async (partial) => {\n    await next(partial);\n\n    const newState = get();\n    history = history.slice(0, historyIndex + 1);\n    history.push(newState);\n    historyIndex++;\n\n    console.log(`\u23f1\ufe0f History: ${historyIndex}/${history.length}`);\n  };\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Use it: ",(0,i.jsx)(n.code,{children:"window.__devtools__.undo()"})," and ",(0,i.jsx)(n.code,{children:"window.__devtools__.redo()"})]}),"\n",(0,i.jsx)(n.h3,{id:"4-analytics-middleware",children:"4. Analytics Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Track user actions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const analyticsMiddleware = (set, get) => (next) => async (partial) => {\n  const state = get();\n  const actionName = typeof partial === 'function' ? 'update' : Object.keys(partial)[0];\n\n  // Send to analytics\n  fetch('/api/analytics', {\n    method: 'POST',\n    body: JSON.stringify({\n      action: actionName,\n      timestamp: Date.now(),\n      previousState: state,\n    }),\n  });\n\n  await next(partial);\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5-debounce-middleware",children:"5. Debounce Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Debounce frequent updates (useful for search, typing, etc.):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const debounceMiddleware = (ms: number) => {\n  let timeoutId: NodeJS.Timeout;\n\n  return (set, get) => (next) => async (partial) => {\n    clearTimeout(timeoutId);\n\n    timeoutId = setTimeout(async () => {\n      await next(partial);\n      console.log('\u23f1\ufe0f Debounced update applied');\n    }, ms);\n  };\n};\n\n// Usage: Wait 300ms before updating search\nconst useSearchStore = create(\n  (set) => ({\n    query: '',\n    setQuery: (query: string) => set({ query }),\n  }),\n  debounceMiddleware(300)\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"real-world-example",children:"Real-World Example"}),"\n",(0,i.jsx)(n.p,{children:"Let's combine multiple middleware for a complete user store:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"type UserStore = {\n  user: null | { id: number; email: string; name: string }\n  isLoading: boolean\n  error: null | string\n  setUser: (user: any) => void\n  logout: () => void\n}\n\nconst useUserStore = create<UserStore>(\n  (set, get) => {\n    // Load persisted user\n    const saved = localStorage.getItem('user');\n    const initialUser = saved ? JSON.parse(saved) : null;\n\n    return {\n      user: initialUser,\n      isLoading: false,\n      error: null,\n      \n      setUser: (user) => set({ user }),\n      logout: () => set({ user: null, error: null }),\n    };\n  },\n  [\n    // Logger first\n    (set, get) => (next) => async (partial) => {\n      console.log('Updating:', partial);\n      await next(partial);\n    },\n    \n    // Validation\n    (set, get) => (next) => async (partial) => {\n      const updates = typeof partial === 'function' ? partial(get()) : partial;\n      if ('user' in updates && updates.user && !updates.user.email?.includes('@')) {\n        console.error('Invalid email');\n        return;\n      }\n      await next(partial);\n    },\n    \n    // Persistence\n    (set, get) => (next) => async (partial) => {\n      await next(partial);\n      if ('user' in get()) {\n        localStorage.setItem('user', JSON.stringify(get().user));\n      }\n    },\n  ]\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"1-keep-middleware-pure",children:"1. Keep Middleware Pure"}),"\n",(0,i.jsx)(n.p,{children:"Middleware should not modify external state directly:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"//  Good\nconst middleware = (set, get) => (next) => async (partial) => {\n  console.log('Updating');\n  await next(partial);\n};\n\n//  Bad\nlet counter = 0;\nconst badMiddleware = (set, get) => (next) => async (partial) => {\n  counter++; // Side effect!\n  await next(partial);\n};\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"2-call-next-only-once",children:["2. Call ",(0,i.jsx)(n.code,{children:"next"})," Only Once"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"//  Good\nconst middleware = (set, get) => (next) => async (partial) => {\n  console.log('Before');\n  await next(partial);\n  console.log('After');\n};\n\n//  Bad - causes issues\nconst badMiddleware = (set, get) => (next) => async (partial) => {\n  await next(partial);\n  set(partial); // Calls middleware again!\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-order-matters",children:"3. Order Matters"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// This logs, then persists\nconst store1 = create(initialState, [loggerMiddleware, persistenceMiddleware]);\n\n// This persists, then logs\nconst store2 = create(initialState, [persistenceMiddleware, loggerMiddleware]);\n\n// Same middlewares, different behavior!\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-handle-errors-gracefully",children:"4. Handle Errors Gracefully"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const safeMiddleware = (set, get) => (next) => async (partial) => {\n  try {\n    await next(partial);\n  } catch (error) {\n    console.error('Middleware error:', error);\n    // Handle gracefully - maybe revert state\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,i.jsx)(n.h3,{id:"1-keep-middleware-lightweight",children:"1. Keep Middleware Lightweight"}),"\n",(0,i.jsx)(n.p,{children:"Avoid heavy computations inside middleware:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"//  Lightweight\nconst middleware = (set, get) => (next) => async (partial) => {\n  console.log('Update');\n  await next(partial);\n};\n\n//  Heavy computation\nconst heavyMiddleware = (set, get) => (next) => async (partial) => {\n  const result = await runExpensiveCalculation();\n  await next(partial);\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-consider-conditional-middleware",children:"2. Consider Conditional Middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const conditionalLogger = \n  process.env.NODE_ENV === 'development' \n    ? loggerMiddleware \n    : (set, get) => (next) => (partial) => next(partial);\n\nconst useStore = create(initialState, conditionalLogger);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"testing-middleware",children:"Testing Middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"describe('loggerMiddleware', () => {\n  it('should log state changes', async () => {\n    const logs: any[] = [];\n    const originalLog = console.log;\n    console.log = (...args) => logs.push(args);\n\n    const useStore = create(\n      (set) => ({\n        count: 0,\n        increment: () => set((state) => ({ count: state.count + 1 })),\n      }),\n      (set, get) => (next) => async (partial) => {\n        console.log('Updating:', partial);\n        await next(partial);\n      }\n    );\n\n    useStore.setState((state) => ({ count: state.count + 1 }));\n\n    expect(logs.length).toBeGreaterThan(0);\n    console.log = originalLog;\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"Zustic middleware provides a clean, functional approach to extending state management:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Simple"})," - Easy to understand and create\n",(0,i.jsx)(n.strong,{children:"Composable"})," - Chain multiple middleware together\n",(0,i.jsx)(n.strong,{children:"Powerful"})," - Handle logging, persistence, validation, and more\n",(0,i.jsx)(n.strong,{children:"Flexible"})," - Create custom middleware for any use case"]}),"\n",(0,i.jsx)(n.p,{children:"Start using middleware to build more robust, observable, and maintainable state management!"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Next Steps:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Check out the ",(0,i.jsx)(n.a,{href:"/docs/tutorial-extras/middleware",children:"Middleware Guide"})," for complete documentation"]}),"\n",(0,i.jsxs)(n.li,{children:["See ",(0,i.jsx)(n.a,{href:"/docs/tutorial-extras/advanced-examples",children:"Advanced Examples"})," for complex middleware patterns"]}),"\n",(0,i.jsxs)(n.li,{children:["Read our ",(0,i.jsx)(n.a,{href:"/docs/tutorial-extras/best-practices",children:"Best Practices"})," guide"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>s,x:()=>l});var a=t(6540);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}},3011(e){e.exports=JSON.parse('{"permalink":"/blog/understanding-middleware-in-state-management","source":"@site/blog/2026-02-06-understanding-middleware-in-state-management/index.md","title":"Understanding Middleware: The Power Behind State Management","description":"Deep dive into middleware patterns. Learn how middleware extends state management with logging, persistence, validation, and more.","date":"2026-02-06T00:00:00.000Z","tags":[{"inline":false,"label":"Middleware","permalink":"/blog/tags/middleware","description":"Middleware patterns and concepts"},{"inline":false,"label":"React","permalink":"/blog/tags/react","description":"React and JavaScript posts"},{"inline":false,"label":"State Management","permalink":"/blog/tags/state-management","description":"State management patterns and libraries"},{"inline":false,"label":"Zustic","permalink":"/blog/tags/zustic","description":"Posts about Zustic state management library"}],"readingTime":5.76,"hasTruncateMarker":true,"authors":[{"name":"Zustic Team","title":"Lightweight State Management Library","url":"https://zustic.github.io","socials":{"github":"https://github.com/DeveloperRejaul","npm":"zustic"},"imageURL":"/img/logo.png","key":"zustic","page":null}],"frontMatter":{"slug":"understanding-middleware-in-state-management","title":"Understanding Middleware: The Power Behind State Management","authors":["zustic"],"tags":["middleware","react","state-management","zustic"],"description":"Deep dive into middleware patterns. Learn how middleware extends state management with logging, persistence, validation, and more.","image":"/img/logo.png"},"unlisted":false,"prevItem":{"title":"React State Management: A Complete Guide","permalink":"/blog/react-state-management-guide"},"nextItem":{"title":"Simple State Management: Making State Easy with Zustic","permalink":"/blog/simple-state-management-made-easy"}}')}}]);