"use strict";(globalThis.webpackChunkzustic_doc=globalThis.webpackChunkzustic_doc||[]).push([[537],{2353(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"tutorial-extras/middleware","title":"Middleware Guide","description":"Learn how to use Zustic\'s middleware system to extend functionality.","source":"@site/docs/tutorial-extras/middleware.md","sourceDirName":"tutorial-extras","slug":"/tutorial-extras/middleware","permalink":"/docs/tutorial-extras/middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial-extras/middleware.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"API Reference","permalink":"/docs/tutorial-extras/api-reference"},"next":{"title":"Advanced Examples","permalink":"/docs/tutorial-extras/advanced-examples"}}');var i=t(4848),r=t(8453);const s={sidebar_position:6},l="Middleware Guide",d={},o=[{value:"What is Middleware?",id:"what-is-middleware",level:2},{value:"Middleware Signature",id:"middleware-signature",level:2},{value:"Creating a Middleware",id:"creating-a-middleware",level:2},{value:"Basic Logger Middleware",id:"basic-logger-middleware",level:3},{value:"Using Middleware",id:"using-middleware",level:3},{value:"Multiple Middleware",id:"multiple-middleware",level:3},{value:"Common Middleware Patterns",id:"common-middleware-patterns",level:2},{value:"1. Logging Middleware",id:"1-logging-middleware",level:3},{value:"2. Persistence Middleware",id:"2-persistence-middleware",level:3},{value:"3. Validation Middleware",id:"3-validation-middleware",level:3},{value:"4. Time-Travel Middleware",id:"4-time-travel-middleware",level:3},{value:"5. Debounce Middleware",id:"5-debounce-middleware",level:3},{value:"6. Async Middleware",id:"6-async-middleware",level:3},{value:"7. Analytics Middleware",id:"7-analytics-middleware",level:3},{value:"Advanced Patterns",id:"advanced-patterns",level:2},{value:"Conditional Middleware",id:"conditional-middleware",level:3},{value:"Middleware with Rollback",id:"middleware-with-rollback",level:3},{value:"Rate Limiting",id:"rate-limiting",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Keep Middleware Pure",id:"1-keep-middleware-pure",level:3},{value:"2. Handle Errors",id:"2-handle-errors",level:3},{value:"3. Avoid Infinite Loops",id:"3-avoid-infinite-loops",level:3},{value:"4. Order Matters",id:"4-order-matters",level:3},{value:"Testing Middleware",id:"testing-middleware",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"1. Async Middleware",id:"1-async-middleware",level:3},{value:"2. Avoid Heavy Computations",id:"2-avoid-heavy-computations",level:3},{value:"Summary",id:"summary",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"middleware-guide",children:"Middleware Guide"})}),"\n",(0,i.jsx)(n.p,{children:"Learn how to use Zustic's middleware system to extend functionality."}),"\n",(0,i.jsx)(n.h2,{id:"what-is-middleware",children:"What is Middleware?"}),"\n",(0,i.jsx)(n.p,{children:"Middleware are functions that intercept and can modify state updates. They're useful for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Logging"})," - Track state changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Persistence"})," - Save state automatically"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validation"})," - Enforce state constraints"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DevTools Integration"})," - Debug state changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Time Travel"})," - Replay actions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Analytics"})," - Track user actions"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"middleware-signature",children:"Middleware Signature"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"type Middleware<T> = (\n  set: (partial: SetSateParams<T>) => void,\n  get: () => T\n) => (\n  next: (partial: SetSateParams<T>) => void\n) => (partial: SetSateParams<T>) => void\n"})}),"\n",(0,i.jsx)(n.p,{children:"Breaking it down:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Outer function"})," receives ",(0,i.jsx)(n.code,{children:"set"})," and ",(0,i.jsx)(n.code,{children:"get"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Middle function"})," receives ",(0,i.jsx)(n.code,{children:"next"})," (the next middleware or setState)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inner function"})," receives the actual update ",(0,i.jsx)(n.code,{children:"partial"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-middleware",children:"Creating a Middleware"}),"\n",(0,i.jsx)(n.h3,{id:"basic-logger-middleware",children:"Basic Logger Middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const logger = (set, get) => (next) => async (partial) => {\n  // Before update\n  console.log('Previous state:', get());\n  console.log('Update:', partial);\n\n  // Call next middleware or setState\n  await next(partial);\n\n  // After update\n  console.log('Updated state:', get());\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"using-middleware",children:"Using Middleware"}),"\n",(0,i.jsxs)(n.p,{children:["Pass middleware as the second parameter to ",(0,i.jsx)(n.code,{children:"create"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const useStore = create(\n  (set, get) => ({\n    count: 0,\n    increment: () => set((state) => ({ count: state.count + 1 })),\n  }),\n  [logger] // Single middleware\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"multiple-middleware",children:"Multiple Middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const useStore = create(\n  (set, get) => ({...}),\n  [middleware1, middleware2, middleware3]\n);\n\n// Execution order:\n// middleware1 \u2192 middleware2 \u2192 middleware3 \u2192 setState\n"})}),"\n",(0,i.jsx)(n.p,{children:"Middleware are applied from left to right, each wrapping the next."}),"\n",(0,i.jsx)(n.h2,{id:"common-middleware-patterns",children:"Common Middleware Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"1-logging-middleware",children:"1. Logging Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Track all state changes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const loggerMiddleware = (set, get) => (next) => async (partial) => {\n  const prev = get();\n  const timestamp = new Date().toISOString();\n\n  console.group(` State Update - ${timestamp}`);\n  console.log('Previous:', prev);\n  console.log('Update:', partial);\n\n  await next(partial);\n\n  console.log('New:', get());\n  console.groupEnd();\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-persistence-middleware",children:"2. Persistence Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Auto-save to localStorage:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const persistMiddleware = (key: string) => (set, get) => (next) => async (partial) => {\n  await next(partial);\n\n  try {\n    const state = get();\n    localStorage.setItem(key, JSON.stringify(state));\n    console.log('\ud83d\udcbe Saved to localStorage');\n  } catch (error) {\n    console.error('Failed to persist:', error);\n  }\n};\n\n// Usage:\nconst useStore = create(\n  (set, get) => {\n    const saved = localStorage.getItem('mystore');\n    return {\n      ...JSON.parse(saved || '{}'),\n      increment: () => set((state) => ({ count: state.count + 1 })),\n    };\n  },\n  [persistMiddleware('mystore')]\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-validation-middleware",children:"3. Validation Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Validate updates before applying:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const validateMiddleware = (set, get) => (next) => async (partial) => {\n  const state = get();\n  const updates = typeof partial === 'function' ? partial(state) : partial;\n\n  // Custom validation logic\n  if ('age' in updates && updates.age < 0) {\n    console.warn(' Age cannot be negative');\n    return;\n  }\n\n  if ('email' in updates && !updates.email.includes('@')) {\n    console.warn(' Invalid email');\n    return;\n  }\n\n  await next(partial);\n  console.log(' Validation passed');\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-time-travel-middleware",children:"4. Time-Travel Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Store history for debugging:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const historyMiddleware = (set, get) => {\n  let history = [get()];\n  let historyIndex = 0;\n\n  return (next) => async (partial) => {\n    await next(partial);\n\n    const state = get();\n    history = history.slice(0, historyIndex + 1);\n    history.push(state);\n    historyIndex++;\n\n    console.log(`History: ${historyIndex + 1}/${history.length}`);\n  };\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5-debounce-middleware",children:"5. Debounce Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Debounce frequent updates:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const debounceMiddleware = (ms: number) => {\n  let timeoutId: NodeJS.Timeout;\n\n  return (set, get) => (next) => async (partial) => {\n    clearTimeout(timeoutId);\n\n    timeoutId = setTimeout(async () => {\n      await next(partial);\n      console.log('\u23f1\ufe0f Debounced update applied');\n    }, ms);\n  };\n};\n\n// Usage:\nconst useStore = create(\n  (set, get) => ({\n    searchQuery: '',\n    setQuery: (query: string) => set({ searchQuery: query }),\n  }),\n  [debounceMiddleware(300)] // Wait 300ms before updating\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"6-async-middleware",children:"6. Async Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Handle async operations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const asyncMiddleware = (set, get) => (next) => async (partial) => {\n  console.log('\u23f3 Processing...');\n\n  try {\n    await next(partial);\n    console.log(' Update completed');\n  } catch (error) {\n    console.error(' Update failed:', error);\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"7-analytics-middleware",children:"7. Analytics Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Track user actions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const analyticsMiddleware = (set, get) => (next) => async (partial) => {\n  const actionName = typeof partial === 'function' \n    ? 'update' \n    : Object.keys(partial)[0];\n\n  // Send to analytics service\n  fetch('/api/analytics', {\n    method: 'POST',\n    body: JSON.stringify({\n      action: actionName,\n      timestamp: Date.now(),\n      previousState: get(),\n    }),\n  });\n\n  await next(partial);\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"advanced-patterns",children:"Advanced Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"conditional-middleware",children:"Conditional Middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const conditionalMiddleware = (shouldLog: boolean) => (set, get) => (next) => async (partial) => {\n  if (shouldLog) {\n    console.log('Update:', partial);\n  }\n  await next(partial);\n};\n\n// Usage:\nconst useStore = create(\n  (set, get) => ({...}),\n  [conditionalMiddleware(process.env.NODE_ENV === 'development')]\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"middleware-with-rollback",children:"Middleware with Rollback"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const rollbackMiddleware = (set, get) => (next) => async (partial) => {\n  const previousState = get();\n\n  try {\n    await next(partial);\n  } catch (error) {\n    console.error('Error occurred, rolling back:', error);\n    set(previousState);\n    throw error;\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const rateLimitMiddleware = (maxUpdates: number, window: number) => {\n  const updates: number[] = [];\n\n  return (set, get) => (next) => async (partial) => {\n    const now = Date.now();\n    const recentUpdates = updates.filter(t => now - t < window);\n\n    if (recentUpdates.length >= maxUpdates) {\n      console.warn(' Rate limit exceeded');\n      return;\n    }\n\n    updates.push(now);\n    await next(partial);\n  };\n};\n\n// Usage: Max 5 updates per 1 second\nconst useStore = create(\n  (set, get) => ({...}),\n  [rateLimitMiddleware(5, 1000)]\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"1-keep-middleware-pure",children:"1. Keep Middleware Pure"}),"\n",(0,i.jsx)(n.p,{children:"Middleware should not have side effects outside of logging/persistence:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"//  Good\nconst middleware = (set, get) => (next) => async (partial) => {\n  console.log('Updating');\n  await next(partial);\n};\n\n//  Bad - modifying external state\nlet counter = 0;\nconst badMiddleware = (set, get) => (next) => async (partial) => {\n  counter++; // Side effect!\n  await next(partial);\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-handle-errors",children:"2. Handle Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const safeMiddleware = (set, get) => (next) => async (partial) => {\n  try {\n    await next(partial);\n  } catch (error) {\n    console.error('Middleware error:', error);\n    // Handle gracefully\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-avoid-infinite-loops",children:"3. Avoid Infinite Loops"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"//  Bad - causes infinite loop\nconst badMiddleware = (set, get) => (next) => async (partial) => {\n  await next(partial);\n  set(partial); // Calls middleware again!\n};\n\n//  Good - call next only once\nconst goodMiddleware = (set, get) => (next) => async (partial) => {\n  await next(partial);\n  console.log('Update complete');\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-order-matters",children:"4. Order Matters"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Different order = different behavior\nconst useStore1 = create((set) => ({...}), [loggerMiddleware, persistMiddleware]);\nconst useStore2 = create((set) => ({...}), [persistMiddleware, loggerMiddleware]);\n\n// useStore1 logs, then persists\n// useStore2 persists, then logs\n"})}),"\n",(0,i.jsx)(n.h2,{id:"testing-middleware",children:"Testing Middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"describe('loggerMiddleware', () => {\n  it('should log state changes', async () => {\n    const logs: any[] = [];\n    const originalLog = console.log;\n    console.log = (...args) => logs.push(...args);\n\n    const useStore = create(\n      (set) => ({\n        count: 0,\n        increment: () => set((state) => ({ count: state.count + 1 })),\n      }),\n      [loggerMiddleware]\n    );\n\n    const store = useStore.getState();\n    store.increment();\n\n    expect(logs.length).toBeGreaterThan(0);\n    console.log = originalLog;\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsx)(n.h3,{id:"1-async-middleware",children:"1. Async Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Be careful with async middleware - they can slow down updates:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Lighter weight - sync logging\nconst syncLogger = (set, get) => (next) => (partial) => {\n  console.log('Update:', partial);\n  next(partial);\n};\n\n// Heavier - async operations\nconst asyncLogger = (set, get) => (next) => async (partial) => {\n  console.log('Update:', partial);\n  await next(partial);\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-avoid-heavy-computations",children:"2. Avoid Heavy Computations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"//  Don't do heavy work in middleware\nconst badMiddleware = (set, get) => (next) => async (partial) => {\n  const expensiveCalculation = await runHeavyComputation();\n  await next(partial);\n};\n\n//  Keep middleware lightweight\nconst goodMiddleware = (set, get) => (next) => async (partial) => {\n  console.log('Updating');\n  await next(partial);\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"Middleware in Zustic provides powerful extensibility for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Debugging and monitoring"}),"\n",(0,i.jsx)(n.li,{children:"Persistence and synchronization"}),"\n",(0,i.jsx)(n.li,{children:"Validation and constraints"}),"\n",(0,i.jsx)(n.li,{children:"Analytics and tracking"}),"\n",(0,i.jsx)(n.li,{children:"Time travel and history"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Use them to build robust, observable state management!"})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>s,x:()=>l});var a=t(6540);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);